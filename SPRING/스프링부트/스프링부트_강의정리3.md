<h3>스프링 부트 - 외부 설정</h3>

1. 하나의 애플리케이션을 여러 다른 환경에서 사용할 때
    ex) 개발 환경 : 개발 서버, 개발 DB 사용
        운영 환경 : 운영 서버, 운영 DB 사용 => 각각의 환경에 따라 다른 설정값이 존재한다.

2. 해결 방법
    - 1. 환경에 따라 변하는 설정값을 실행 시점에 주입
        - 1. 배포 환경과 무관하게 하나의 빌드 결과물을 만든다.
        - 2. 설정값은 실행 시점에 각 환경에 따라 외부에서 주입한다.
        - ex) 개발 서버 : dev.db.com 값을 외부 설정으로 주입, 운영 서버: prod.db.com 값을 외부 설정으로 주입

3. 외부 설정 불러오는 법 - 4가지 방법
    - 1. os 환경 변수 : os에서 지원하는 외부 설정, 해당 os를 사용하는 모든 프로세스에서 사용
    - 2. 자바 시스템 속성 : 자바에서 지원하는 외부 설정, 해당 JVM 안에서 사용
    - 3. 자바 커맨드 라인 인수 : 커맨드 라인에서 전달하는 외부 설정, 실행 시 main 메서드에서 사용
    - 4. 외부 파일(설정 데이터) : 프로그램에서 외부 파일을 직접 읽음, 각 서버마다 해당 파일 안에 다른 설정 정보를 남겨둔다.

4. 외부 설정 - OS 환경 변수
    - 해당 OS를 사용하는 모든 프로그램에서 읽을 수 있는 설정값
    - System.getenv() : 전체 os 환경 변수를 map으로 조회
    - System.getenv(key) : 특정 os 환경 변수값을 string으로 조회
   => os 환경 변수를 설정하고, 필요한 곳에서 system.getenv()를 사용하면 외부 설정을 사용할 수 있다.
    - ex) 개발 서버에서는 DBURL = dev.db.com, 운영 서버에서는 DBURL = prod.db.com 
            => system.getenv("DBURL")을 조회할 때 각 환경에 따라 다른 값을 읽는다.

5. 외부 설정 - 자바 시스템 속성
    - 실행한 jvm 안에서 접근 가능한 외부 설정
    - ex) java -D url=dev -jar app.jar => -D VM 옵션을 통해서 key=value 형식을 주면 된다.
    - system.getproperties()를 사용하면, map의 자식 타입 key=value 형식의 properties를 받을 수 있다. 
        => 모든 자바 시스템 속성 조회 가능
    - system.getproperty(key)를 사용하면 특정 속성값 조회 가능

6. 자바 시스템 속성 - 선정 방법
    - 1. -D 옵션을 통해 실행 시점에 전달
        ex) java -D url=devdb -D username=dev_user -D password=dev_pw -jar app.jar
    - 2. 자바 코드로 실행
        설정: system.setproperty(propertyname, "propertyvalue")
        조회: system.getproperty(propertyname)

7. 외부 설정 - 커맨드 라인 인수
    - 커맨드 라인 인수는 애플리케이션 실행 시점에 외부 설정값을 main(arg) 메서드의 args 파라미터로 전달하는 방법이다.
    - ex) java -jar app.jar dataA dataB
    - 단점: 커맨드 라인 인수는 key=value 형식이 아니고, 단순히 문자를 여러 개 입력받는 방식이므로, 개발자가 직접 데이터를 파싱해서
         key=value 형식에 맞도록 분리해야 한다.

8. 외부 설정 - 커맨드 라인 옵션 인수
    - 스프링에서 커맨드 라인 인수를 key=value 형식으로 사용할 수 잇도록 스프링만의 표준 형식을 정의했다.
    - ex) --username=userA --username=userB 이런 식으로, --key=value 형식으로 사용한다.

9. 커맨드 라인 옵션 인수 - 사용 방법
    - ApplicationArguments appArgs = new DefaultApplicationArguments(args);
    - List<String> url = appArgs.getoptionvalues("url");
   => 옵션 인수를 조회할 수 있다.

10. 커맨드 라인 옵션 인수 - 스프링 부트
    - 스프링 부트는 applicationarguments를 스프링 빈으로 등록하고, 그 안에 입력한 커맨드 라인을 저장해 둔다.
    - 해당 빈을 주입받으면 커맨드 라인으로 입력한 값을 어디서든 사용할 수 있다.

11. 외부 설정 - 스프링 통합
    - 위 방법대로면, 외부 설정값을 os 환경 변수에 두면 system.getenv(key), 자바 시스템 속성을 사용하면 system.getproperty(key)를
    사용해야 한다.
    => 정책 변경 시에 있는 코드를 변경해야 한다.(x)
    => 외부 설정값이 어디에 위치하든 상관없이, 일관성 있고 편리하게 key=value 형식의 외부 설정값을 읽는 방법이 필요하다.
    => 스프링의 Environment, PropertySource 추상화

12. 스프링의 외부 설정 통합
    PropertySource
    - 스프링은 PropertySource라는 추상 클래스를 제공하고, 각각의 외부 설정을 조회하는 xxxPropertySource라는 구현체를 만들어 두었다.
    - ex) commandlinePropertySource, SystemEnvironmentPropertySource => 스프링은 로딩 시점에 필요한 propertysource를 생성하고,
    environment에서 사용할 수 있게 연결해 둔다.

    Environment
    - Environment를 통해서 특정 외부 설정에 종속되지 않고, 일관성 있게 key=value 형식의 외부 설정에 접근할 수 있다.
    - environment.getproperty(key)를 통해서 값을 조회할 수 있다.
    - 스프링은 우선 순위에 따라 각 propertysource에 접근하여, 외부 설정을 가져온다.

13. 결론
    - 커맨드 라인 옵션 인수, 자바 시스템 속성 모두 environment를 통해 동일한 방법으로 읽을 수 있다.
    => environment를 이용하여 외부 설정 읽는 방법 추상화
    - 외부 설정 읽는 방법이 변경되어도, 개발 소스 코드를 변경하지 않아도 된다.

14. 










